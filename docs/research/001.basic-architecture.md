# 001. 基础架构

## 项目概述

**wpp-manager** - 多账号 WhatsApp 管理系统 (Electron + FastAPI)

---

## 技术栈

### 桌面端

| 技术 | 用途 |
|------|------|
| Electron 39 | 桌面框架 |
| Vue 3.5 | UI 框架 |
| Element Plus 2.13 | 组件库 |
| @wppconnect-team/wppconnect 1.37 | WhatsApp 集成 |
| TypeScript 5.7 | 类型系统 |

### 服务器端

| 技术 | 用途 |
|------|------|
| FastAPI 0.124+ | Web 框架 |
| SQLAlchemy 2.0+ | ORM |
| MySQL | 数据库 |
| Redis 7.1+ | 缓存/会话 |
| PyJWT | 认证 |

---

## 项目结构

```
wpp/
├── desktop_old/          # 桌面端 (Electron + Vue 3)
│   ├── src/
│   │   ├── main/        # 主进程
│   │   ├── renderer/    # 渲染进程
│   │   ├── preload/     # Preload 脚本
│   │   └── shared/      # 共享代码
│   └── package.json
├── server/              # 后端 (FastAPI)
│   ├── src/app/
│   │   ├── api/         # 路由
│   │   ├── core/        # 配置
│   │   ├── models/      # 模型
│   │   ├── services/    # 业务逻辑
│   │   └── middleware/  # 中间件
│   ├── deploy/          # 部署脚本
│   └── config.yaml
├── desktop/             # 新版桌面端 (开发中)
├── admin/               # 管理后台
└── docs/                # 文档
```

---

## 整体架构

```
┌─────────────────────────────────────────┐
│         Electron Desktop App             │
│  TabBar | Admin View (Vue 3) | WhatsApp  │
└───────────────────┬─────────────────────┘
                    │ HTTP API
                    ↓
┌─────────────────────────────────────────┐
│           FastAPI Backend               │
│  API Layer | Service Layer | Data Layer │
└─────────────────────────────────────────┘
```

---

## 核心配置

### 桌面端

**位置**: `desktop_old/package.json`

**脚本**: dev (开发), build (构建)

### 服务器端

**位置**: `server/config.yaml`

**配置**: app, database, redis, auth, smtp

---

## 启动流程

### 桌面端

```
electron-vite dev → 主进程启动 → 注册协议 → 创建窗口 → BrowserViewManager → 创建 TabBar/Admin → WhatsAppAccountManager → IPC Handlers → 加载 Vue
```

### 服务器端

```
uvicorn → 加载配置 → 创建 FastAPI → 注册中间件 → 注册路由 → 初始化数据库 → 启动服务
```

---

## 关键特性

**多账号隔离**: 独立 partition (`persist:wa-{accountId}`)

**IPC 通信**: 主进程 ↔ 渲染进程 (contextBridge)，主进程 ↔ WhatsApp View (专用通道)

**视图管理**: BrowserViewManager 管理所有 WebContentsView，标签页式切换

**反检测**: 隐藏 Electron 特征，修改 User-Agent

---

## 部署架构

**开发**: Electron 热重载，FastAPI 单进程

**生产**:
- Electron: 构建分发 (DMG/EXE)
- FastAPI: Supervisor + Nginx + GitHub Actions CI/CD

---

## 相关文档

- [002. 浏览器通信](./002.browser-communication.md)
- [003. 服务器端架构](./003.server-architecture.md)
- [004. 桌面端架构](./004.desktop-architecture.md)
- [005. 部署与配置](./005.deployment-and-config.md)
